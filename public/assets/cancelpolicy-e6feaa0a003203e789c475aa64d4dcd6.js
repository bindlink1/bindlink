function abortcancellation(){$("#policyactions").slideUp(300),$("#policyactions").html(""),$("#policyfields").slideDown(300),$("#policytransinv").slideDown(300),$("#transactiontable").slideDown(300),$("#invoicetable").slideDown(300),$("#editpolbutton").removeAttr("disabled"),$("#cancelpolbutton").removeAttr("disabled"),$("#endorsepolbutton").removeAttr("disabled")}function feechangecalc(){var e=$("#policypremiumtransaction_fees").val().replace(/[^0-9\.\(\)]+/g,""),a=parseFloat(e).toFixed(2),t=$("#policypremiumtransaction_base_premium").val().replace(/[^0-9\.\(\)]+/g,""),r=parseFloat(t).toFixed(2);isNaN(r)&&(r=0),$("#policypremiumtransaction_total_premium").val(Number(r)+Number(a)),$("#policypremiumtransaction_total_premium").effect("highlight",1e3),$("#policypremiumtransaction_total_premium").formatCurrency()}function recalculatefees(){var t=0;$(".complexfee input").each(function(){var e=$(this).val().replace(/[^0-9\.]+/g,""),a=parseFloat(e).toFixed(2);isNaN(Number(a))&&(a=0),t=Number(t)+Number(a)}),$("#policypremiumtransaction_complexfees").val(t).formatCurrency(),totalpremcalc()}$("#policypremiumtransaction_fees").change(function(){totalpremcalc(),returnamountgnome()}),$("#policypremiumtransaction_base_premium").change(function(){feecalc(),totalpremcalc(),returnamountgnome()}),$("#policypremiumtransaction_total_premium").change(function(){returnamountgnome()}),$("#my-modal").on("hidden",function(){$("#policypremiumtransaction_fees").val(0),$("#policypremiumtransaction_base_premium").val(0),$("#policypremiumtransaction_total_premium").val(0)}),$("#gobackcancel").click(function(){abortcancellation()}),$(document).ready($(function(){$("#new_policypremiumtransaction").validate({rules:{"policypremiumtransaction[base_premium]":{required:!0,greaterThanZero:!0},"policypremiumtransaction[taxes]":{greaterThanZero:!0},"policypremiumtransaction[fees]":{greaterThanEqualZero:!0},"policypremiumtransaction[total_premium]":{greaterThanZero:!0}}}),jQuery.validator.addMethod("greaterThanZero",function(e,a){var t=e.replace(/[^0-9\.\(\)]+/g,"");return this.optional(a)||0<parseFloat(t).toFixed(2)},"* Amount must be greater than zero"),jQuery.validator.addMethod("greaterThanEqualZero",function(e,a){var t=e.replace(/[^0-9\.\(\)]+/g,"");return this.optional(a)||0<=parseFloat(t).toFixed(2)},"* Amount must not be negative")})),$("#policypremiumtransaction_base_premium").change(function(){$(this).formatCurrency(),feecalc(),totalpremcalc()}),$("#policypremiumtransaction_taxes").change(function(){$(this).formatCurrency(),totalpremcalc()}),$("#policypremiumtransaction_fees").change(function(){$(this).formatCurrency(),feechangecalc()}),$("#policypremiumtransaction_complexfees").change(function(){$(this).formatCurrency(),feechangecalc()}),$(".complexfee input").change(function(){$(this).formatCurrency(),recalculatefees()});