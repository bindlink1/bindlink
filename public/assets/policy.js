function uploadstatus(e){"start"==e&&($("#uploadstatus").addClass("alert"),$("#uploadstatus").html("uploading your document")),"complete"==e&&($("#uploadstatus").addClass("alert-success"),$("#uploadstatus").html("upload status: "+e))}function updatepolicy(e,a){$.ajax({type:"GET",dataType:"script",data:{transtype:a,policy_id:e},url:"/policies/updateaftertransaction"})}function openinvoicegnome(){var l=$("#policypremiumtransaction_total_premium").val().replace(/[^0-9\.\(\)]+/g,""),n=$("#policypremiumtransaction_base_premium").val();$.ajax({type:"GET",dataType:"json",data:"totalreturn="+l,url:"/policies/cancbalance",success:function(e){var a=l-e.balanceamount,t="";if(a<0){var i="Note: Even after applying the return premium, there is still a balance on this policy.";a*=-1}else{i="";var o=a;a=0;t='<tr><td><b>Return to Policyholder:</b></td><td></td><td style=" text-align: right;"><b>'+addCommas(parseFloat(o).toFixed(2))+"</b></td></tr>"}"balance"==e.balance&&0!=l?($("#my-modal").html('<div class="modal-header"><img src="/assets/bindlinklogofunctional.png"></div><div class="modal-body"><div class="alert"><p>This policy has an invoice with a balance due to your agency. <ul><h4 class="alert-heading">Would you like to apply this return premium towards that invoice?</h4><ul></ul></p>'+i+'</div> <table><tr><th colspan="3" style="border-bottom: 1px solid black; ">Here is what the math looks like</th></tr><tr style="margin-top: 10px;"><td>Invoice Balance:</td><td></td><td style=" text-align: right;">'+addCommas(parseFloat(e.balanceamount).toFixed(2))+'</td></tr><tr><td>Return Premium:</td><td>-</td><td style="border-bottom: 1px solid black; text-align: right;">'+l+'</td></tr><tr><td>New Invoice Balance:</td><td></td><td style=" text-align: right;">'+addCommas(parseFloat(a).toFixed(2))+"</td></tr>"+t+'</table></div><div class="modal-footer"> <a href="#" class="btn btn-primary" id="yesapply">Yes, apply to invoice</a><a href="#" class="btn" id="noapply">No</a></div>'),$("#yesapply").click(function(){applyreturntoinvoice(l,n)}),$("#noapply").click(function(){$("#my-modal").modal("hide"),updatepolicy()}),$("#my-modal").addClass("modal"),$(".modal").appendTo($("body")),$("#my-modal").modal({show:!0,keyboard:!0,backdrop:!0})):updatepolicy()}})}function returnamountgnome(){var e=$("#policypremiumtransaction_total_premium").val();$.ajax({type:"GET",dataType:"text",data:"totalreturn="+e,url:"/policies/returnamountgnome",success:function(e){"over"==e&&($("#my-modal").html('<div class="modal-header"><button class="close" data-dismiss="modal">\xd7</button><h3>Alert</h3></div><div class="modal-body"><p>The Amount you have entered is greater than the total written premium for this policy.</p></div><div class="modal-footer"><a href="#" class="btn" id="returndismiss" data-dismiss="modal">Ok</a></div>'),$("#my-modal").addClass("modal"),$("#my-modal").modal({show:!0,keyboard:!0,backdrop:!0}))}})}function applyreturntoinvoice(e,a){$.ajax({type:"POST",dataType:"json",data:{returnpremium:e,basepremium:a},url:"/policies/cancellationreturntoinvoice",success:function(){$("#my-modal").modal("hide"),updatepolicy()}})}function feecalc(){var t=0,e=$("#policypremiumtransaction_base_premium").val().replace(/[^0-9\.]+/g,""),i=parseFloat(e).toFixed(2),o=new Array,l=new Array,n=new Array;$(".blvalue").each(function(e,a){o[e]=a.value}),$(".blremittype").each(function(e,a){n[e]=a.value}),$(".blinput").each(function(e,a){var t;"Revenue"==n[e]&&(t=0<$(this).val().length?$(this).val().replace(/[^0-9\.]+/g,""):(a.value=o[e],o[e]),i=Number(i)+Number(t))}),$(".bltype").each(function(e,a){l[e]=a.value}),$(".blinput").each(function(e,a){"Revenue"==n[e]&&0<$(this).val().length?(a.value=$(this).val().replace(/[^0-9\.]+/g,""),t+=1*$(this).val().replace(/[^0-9\.]+/g,"")):"Flat"==l[e]?(a.value=o[e],t+=1*o[e]):(a.value=roundfix(o[e]*i),t+=roundfix(o[e]*i))}),$("#policypremiumtransaction_complexfees").val(t).formatCurrency(),$(".complexfee input").formatCurrency()}function totalpremcalc(){if(null!=$("#policypremiumtransaction_complexfees").val())var e=$("#policypremiumtransaction_complexfees").val().replace(/[^0-9\.]+/g,""),a=parseFloat(e).toFixed(2);var t=0;t=$("#policypremiumtransaction_fees").val()==undefined?0:$("#policypremiumtransaction_fees").val().replace(/[^0-9\.]+/g,"");var i=parseFloat(t).toFixed(2),o=$("#policypremiumtransaction_base_premium").val().replace(/[^0-9\.]+/g,""),l=parseFloat(o).toFixed(2);isNaN(i)&&(i=0),isNaN(l)&&(l=0),isNaN(a)&&(a=0),$("#policypremiumtransaction_total_premium").val(Number(l)+Number(i)+Number(a)),$("#policypremiumtransaction_total_premium").formatCurrency()}$(document).ready($(function(){$("#new_note").validate(),$("#uploadbutton").click(function(){uploadstatus("start")}),$("#policyactions").hide(),$("#noteform").hide(),$("#renewcontainer").hide(),$("#hiderenewals").hide(),$("#doclistview").hide(),$("#newnotebtn").click(function(){$("#noteform").slideDown(300)}),$("#notecancel").click(function(){$("#noteform").slideUp(300),$("#note_notetext").val("")}),$("#viewrenewals").click(function(){$("#renewcontainer").slideDown(300),$("#viewrenewals").hide(),$("#hiderenewals").show()}),$("#hiderenewals").click(function(){$("#renewcontainer").slideUp(300),$("#hiderenewals").hide(),$("#viewrenewals").show()}),$("#listviewdocs").click(function(){$("#docgridview").fadeOut(300),$("#doclistview").fadeIn(300)}),$("#gridviewdocs").click(function(){$("#doclistview").fadeOut(300),$("#docgridview").fadeIn(300)})})),$("#policy_policypremiumtransactions_attributes_0_base_premium").change(function(){feegnome(),$(this).formatCurrency()}),$("body").on("change","#template_name",function(e){var a=$("#email_body").val();$("#email_body").val(a+e.target.value)});