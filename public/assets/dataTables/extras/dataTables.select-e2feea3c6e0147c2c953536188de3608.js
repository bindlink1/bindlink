/*! Select for DataTables 1.1.0
 * 2015 SpryMedia Ltd - datatables.net/license/mit
 */
/**
 * @summary     Select for DataTables
 * @description A collection of API methods, events and buttons for DataTables
 *   that provides selection options of the items in a DataTable
 * @version     1.1.0
 * @file        dataTables.select.js
 * @author      SpryMedia Ltd (www.sprymedia.co.uk)
 * @contact     datatables.net/forums
 * @copyright   Copyright 2015 SpryMedia Ltd.
 *
 * This source file is free software, available under the following license:
 *   MIT license - http://datatables.net/license/mit
 *
 * This source file is distributed in the hope that it will be useful, but
 * WITHOUT ANY WARRANTY; without even the implied warranty of MERCHANTABILITY
 * or FITNESS FOR A PARTICULAR PURPOSE. See the license files for details.
 *
 * For details please refer to: http://www.datatables.net/extensions/select
 */
!function(l){"function"==typeof define&&define.amd?define(["jquery","datatables.net"],function(e){return l(e,window,document)}):"object"==typeof exports?module.exports=function(e,t){return e||(e=window),t&&t.fn.dataTable||(t=require("datatables.net")(e,t).$),l(t,e,e.document)}:l(jQuery,window,document)}(function(u,e,t,d){"use strict";function i(n,e,t){var l,s,c,a=function(t,l){if(l<t){var e=l;l=t,t=e}var s=!1;return n.columns(":visible").indexes().filter(function(e){return e===t&&(s=!0),e===l?!(s=!1):s})},o=function(t,l){var e=n.rows({search:"applied"}).indexes();if(e.indexOf(t)>e.indexOf(l)){var s=l;l=t,t=s}var c=!1;return e.filter(function(e){return e===t&&(c=!0),e===l?!(c=!1):c})};c=n.cells({selected:!0}).any()||t?(s=a(t.column,e.column),o(t.row,e.row)):(s=a(0,e.column),o(0,e.row)),l=n.cells(c,s).flatten(),n.cells(e,{selected:!0}).any()?n.cells(l).deselect():n.cells(l).select()}function s(e){var t=e.settings()[0]._select.selector;u(e.table().body()).off("mousedown.dtSelect",t).off("mouseup.dtSelect",t).off("click.dtSelect",t),u("body").off("click.dtSelect")}function c(a){var o=u(a.table().body()),t=a.settings()[0],l=t._select.selector;o.on("mousedown.dtSelect",l,function(e){e.shiftKey&&o.css("-moz-user-select","none").one("selectstart.dtSelect",l,function(){return!1})}).on("mouseup.dtSelect",l,function(){o.css("-moz-user-select","")}).on("click.dtSelect",l,function(e){var t,l=a.select.items(),s=a.settings()[0];if(u(e.target).closest("tbody")[0]==o[0]){var c=u(e.target).closest("td, th"),n=a.cell(c).index();a.cell(c).any()&&("row"===l?(t=n.row,m(e,a,s,"row",t)):"column"===l?(t=a.cell(c).index().column,m(e,a,s,"column",t)):"cell"===l&&(t=a.cell(c).index(),m(e,a,s,"cell",t)),s._select_lastCell=n)}}),u("body").on("click.dtSelect",function(e){if(t._select.blurable){if(u(e.target).parents().filter(a.table().container()).length)return;if(u(e.target).parents("div.DTE").length)return;f(t,!0)}})}function n(e,t,l,s){s&&!e.flatten().length||(l.unshift(e),u(e.table().node()).triggerHandler(t+".dt",l))}function o(l){var e=l.settings()[0];if(e._select.info&&e.aanFeatures.i){var s=u('<span class="select-info"/>'),t=function(e,t){s.append(u('<span class="select-item"/>').append(l.i18n("select."+e+"s",{_:"%d "+e+"s selected",0:"",1:"1 "+e+" selected"},t)))};t("row",l.rows({selected:!0}).flatten().length),t("column",l.columns({selected:!0}).flatten().length),t("cell",l.cells({selected:!0}).flatten().length),u.each(e.aanFeatures.i,function(e,t){var l=(t=u(t)).children("span.select-info");l.length&&l.remove(),""!==s.text()&&t.append(s)})}}function a(a){var l=new h.Api(a);a.aoRowCreatedCallback.push({fn:function(e,t,l){var s,c,n=a.aoData[l];for(n._select_selected&&u(e).addClass(a._select.className),s=0,c=a.aoColumns.length;s<c;s++)(a.aoColumns[s]._select_selected||n._selected_cells&&n._selected_cells[s])&&u(n.anCells[s]).addClass(a._select.className)},sName:"select-deferRender"}),l.on("preXhr.dt.dtSelect",function(){var e=l.rows({selected:!0}).ids(!0).filter(function(e){return e!==d}),t=l.cells({selected:!0}).eq(0).map(function(e){var t=l.row(e.row).id(!0);return t?{row:t,column:e.column}:d}).filter(function(e){return e!==d});l.one("draw.dt.dtSelect",function(){l.rows(e).select(),t.any()&&t.each(function(e){l.cells(e.row,e.column).select()})})}),l.on("draw.dtSelect.dt select.dtSelect.dt deselect.dtSelect.dt",function(){o(l)}),l.on("destroy.dtSelect",function(){s(l),l.off(".dtSelect")})}function r(e,t,l,s){var c=e[t+"s"]({search:"applied"}).indexes(),n=u.inArray(s,c),a=u.inArray(l,c);if(e[t+"s"]({selected:!0}).any()||-1!==n){if(a<n){var o=a;a=n,n=o}c.splice(a+1,c.length),c.splice(0,n)}else c.splice(u.inArray(l,c)+1,c.length);e[t](l,{selected:!0}).any()?(c.splice(u.inArray(l,c),1),e[t+"s"](c).deselect()):e[t+"s"](c).select()}function f(e,t){if(t||"single"===e._select.style){var l=new h.Api(e);l.rows({selected:!0}).deselect(),l.columns({selected:!0}).deselect(),l.cells({selected:!0}).deselect()}}function m(e,t,l,s,c){var n=t.select.style(),a=t[s](c,{selected:!0}).any();if("os"===n)if(e.ctrlKey||e.metaKey)t[s](c).select(!a);else if(e.shiftKey)"cell"===s?i(t,c,l._select_lastCell||null):r(t,s,c,l._select_lastCell?l._select_lastCell[s]:null);else{var o=t[s+"s"]({selected:!0});a&&1===o.flatten().length?t[s](c).deselect():(o.deselect(),t[s](c).select())}else t[s](c).select(!a)}function l(t,l){return function(e){return e.i18n("buttons."+t,l)}}var h=u.fn.dataTable;h.select={},h.select.version="1.1.0",u.each([{type:"row",prop:"aoData"},{type:"column",prop:"aoColumns"}],function(e,i){h.ext.selector[i.type].push(function(e,t,l){var s,c=t.selected,n=[];if(c===d)return l;for(var a=0,o=l.length;a<o;a++)s=e[i.prop][l[a]],(!0===c&&!0===s._select_selected||!1===c&&!s._select_selected)&&n.push(l[a]);return n})}),h.ext.selector.cell.push(function(e,t,l){var s,c=t.selected,n=[];if(c===d)return l;for(var a=0,o=l.length;a<o;a++)s=e.aoData[l[a].row],(!0===c&&s._selected_cells&&!0===s._selected_cells[l[a].column]||!1===c&&(!s._selected_cells||!s._selected_cells[l[a].column]))&&n.push(l[a]);return n});var _=h.Api.register,p=h.Api.registerPlural;return _("select()",function(){}),_("select.blurable()",function(t){return t===d?this.context[0]._select.blurable:this.iterator("table",function(e){e._select.blurable=t})}),_("select.info()",function(t){return o===d?this.context[0]._select.info:this.iterator("table",function(e){e._select.info=t})}),_("select.items()",function(t){return t===d?this.context[0]._select.items:this.iterator("table",function(e){e._select.items=t,n(new h.Api(e),"selectItems",[t])})}),_("select.style()",function(l){return l===d?this.context[0]._select.style:this.iterator("table",function(e){e._select.style=l,e._select_init||a(e);var t=new h.Api(e);s(t),"api"!==l&&c(t),n(new h.Api(e),"selectStyle",[l])})}),_("select.selector()",function(t){return t===d?this.context[0]._select.selector:this.iterator("table",function(e){s(new h.Api(e)),e._select.selector=t,"api"!==e._select.style&&c(new h.Api(e))})}),p("rows().select()","row().select()",function(e){var l=this;return!1===e?this.deselect():(this.iterator("row",function(e,t){f(e),e.aoData[t]._select_selected=!0,u(e.aoData[t].nTr).addClass(e._select.className)}),this.iterator("table",function(e,t){n(l,"select",["row",l[t]],!0)}),this)}),p("columns().select()","column().select()",function(e){var l=this;return!1===e?this.deselect():(this.iterator("column",function(e,t){f(e),e.aoColumns[t]._select_selected=!0;var l=new h.Api(e).column(t);u(l.header()).addClass(e._select.className),u(l.footer()).addClass(e._select.className),l.nodes().to$().addClass(e._select.className)}),this.iterator("table",function(e,t){n(l,"select",["column",l[t]],!0)}),this)}),p("cells().select()","cell().select()",function(e){var l=this;return!1===e?this.deselect():(this.iterator("cell",function(e,t,l){f(e);var s=e.aoData[t];s._selected_cells===d&&(s._selected_cells=[]),s._selected_cells[l]=!0,s.anCells&&u(s.anCells[l]).addClass(e._select.className)}),this.iterator("table",function(e,t){n(l,"select",["cell",l[t]],!0)}),this)}),p("rows().deselect()","row().deselect()",function(){var l=this;return this.iterator("row",function(e,t){e.aoData[t]._select_selected=!1,u(e.aoData[t].nTr).removeClass(e._select.className)}),this.iterator("table",function(e,t){n(l,"deselect",["row",l[t]],!0)}),this}),p("columns().deselect()","column().deselect()",function(){var l=this;return this.iterator("column",function(s,e){s.aoColumns[e]._select_selected=!1;var t=new h.Api(s),l=t.column(e);u(l.header()).removeClass(s._select.className),u(l.footer()).removeClass(s._select.className),t.cells(null,e).indexes().each(function(e){var t=s.aoData[e.row],l=t._selected_cells;!t.anCells||l&&l[e.column]||u(t.anCells[e.column]).removeClass(s._select.className)})}),this.iterator("table",function(e,t){n(l,"deselect",["column",l[t]],!0)}),this}),p("cells().deselect()","cell().deselect()",function(){var l=this;return this.iterator("cell",function(e,t,l){var s=e.aoData[t];s._selected_cells[l]=!1,s.anCells&&!e.aoColumns[l]._select_selected&&u(s.anCells[l]).removeClass(e._select.className)}),this.iterator("table",function(e,t){n(l,"deselect",["cell",l[t]],!0)}),this}),u.extend(h.ext.buttons,{selected:{text:l("selected","Selected"),className:"buttons-selected",init:function(e){var t=this;e.on("draw.dt.DT select.dt.DT deselect.dt.DT",function(){var e=t.rows({selected:!0}).any()||t.columns({selected:!0}).any()||t.cells({selected:!0}).any();t.enable(e)}),this.disable()}},selectedSingle:{text:l("selectedSingle","Selected single"),className:"buttons-selected-single",init:function(t){var l=this;t.on("draw.dt.DT select.dt.DT deselect.dt.DT",function(){var e=t.rows({selected:!0}).flatten().length+t.columns({selected:!0}).flatten().length+t.cells({selected:!0}).flatten().length;l.enable(1===e)}),this.disable()}},selectAll:{text:l("selectAll","Select all"),className:"buttons-select-all",action:function(){var e=this.select.items();this[e+"s"]().select()}},selectNone:{text:l("selectNone","Deselect all"),className:"buttons-select-none",action:function(){f(this.settings()[0],!0)}}}),u.each(["Row","Column","Cell"],function(e,t){var c=t.toLowerCase();h.ext.buttons["select"+t+"s"]={text:l("select"+t+"s","Select "+c+"s"),className:"buttons-select-"+c+"s",action:function(){this.select.items(c)},init:function(e){var s=this;e.on("selectItems.dt.DT",function(e,t,l){s.active(l===c)})}}}),u(t).on("preInit.dt.dtSelect",function(e,t){if("dt"===e.namespace){var l=t.oInit.select||h.defaults.select,s=new h.Api(t),c="row",n="api",a=!1,o=!0,i="td, th",r="selected";t._select={},!0===l?n="os":"string"==typeof l?n=l:u.isPlainObject(l)&&(l.blurable!==d&&(a=l.blurable),l.info!==d&&(o=l.info),l.items!==d&&(c=l.items),l.style!==d&&(n=l.style),l.selector!==d&&(i=l.selector),l.className!==d&&(r=l.className)),s.select.selector(i),s.select.items(c),s.select.style(n),s.select.blurable(a),s.select.info(o),t._select.className=r,u(s.table().node()).hasClass("selectable")&&s.select.style("os")}}),h.select});