function carrierlobgnome(){var e=$("#policy_carrier_id").val();$.ajax({type:"GET",dataType:"json",data:"carrier_id="+e,url:"/policies/carrierlobs",success:function(e){$("#policy_lineofbusiness_id").html(""),$("<option value=''>Select One</option>").appendTo("#policy_lineofbusiness_id"),$.each(e.lobs,function(e,t){$("<option value='"+t.id+"' tag='"+t.billing_type+"'>"+t.line_name+"</option>").appendTo("#policy_lineofbusiness_id")}),$("#policy_lineofbusiness_id").removeAttr("disabled").effect("highlight",1e3)}})}function onLobChange(){var e=$("#policy_lineofbusiness_id option:selected").attr("tag");"0"==e?($("#billingTypeRow").slideDown(),$("#policy_payment_type_id").val("")):($("#billingTypeRow").slideUp(),$("#policy_payment_type_id").val(e))}function feegnome(){0==$(".complexfee input").length?feecalculation():feerecalculation(),$("#policy_lineofbusiness_id").removeAttr("disabled")}function feerecalculation(){var e=$("#policy_state").val(),t=$("#policy_effective_date").val(),i=$("#policy_lineofbusiness_id").val(),a=$("#policy_policypremiumtransactions_attributes_0_base_premium").val().replace(/[^0-9\.]+/g,""),o=parseFloat(a).toFixed(2);$.ajax({type:"GET",dataType:"json",data:{state:e,lob:i,basepremium:o,effective_date:t},url:"/policies/feecalcs",success:function(e){var i=0,a=0;$.each(e.fees,function(e,t){"Revenue"==t[0].fee_remit_type&&(o=Number(o)+1*$("#fees_"+t[0].id).val().replace(/[^0-9\.]+/g,""))}),$.each(e.fees,function(e,t){"Revenue"!=t[0].fee_remit_type?"Percent"==t[0].fee_type?($("#fees_"+t[0].id).val(roundfix(o*t[0].fee_value)),i+=roundfix(o*t[0].fee_value)):($("#fees_"+t[0].id).val(t[0].fee_value),i+=1*t[0].fee_value):i+=1*$("#fees_"+t[0].id).val().replace(/[^0-9\.]+/g,""),a+=1}),$(".complexfee input").formatCurrency(),$(".complexfee input").live("change",function(){$(".complexfee input").formatCurrency(),recalculatefees()}),0<a&&($("#complexfeerow").slideDown(300),$("#complexfeetotal").val(i).formatCurrency(),$("#simplefeerow").hide()),totalpremcalc()}})}function feecalculation(){var e=$("#policy_state").val(),t=$("#policy_effective_date").val(),i=$("#policy_lineofbusiness_id").val(),a=$("#policy_policypremiumtransactions_attributes_0_base_premium").val().replace(/[^0-9\.]+/g,""),o=parseFloat(a).toFixed(2);$.ajax({type:"GET",dataType:"json",data:{state:e,lob:i,basepremium:o,effective_date:t},url:"/policies/feecalcs",success:function(e){$(".complexrow").remove(),$("#feerow").html(""),$(".complexrow").html("");var i=0,a=0;$.each(e.fees,function(e,t){"Revenue"==t[0].fee_remit_type&&(o=Number(o)+1*t[0].fee_value)}),$.each(e.fees,function(e,t){"Percent"==t[0].fee_type?($("#feerow").after("<tr class='complexrow'><td>&nbsp;&nbsp; + "+t[0].fee_name+"</td><td> <div class='complexfee'> <input id='fees_"+t[0].id+"' class='BLselect span2' type='text' size='30' name='policy[policypremiumtransactions_attributes][0][feetransactions_attributes]["+a+"][fee_amount]' autocomplete='off' value="+roundfix(o*t[0].fee_value)+"></div><input type='hidden' id='feesid_"+t[0].id+"' class='BLselect span2' type='text' size='30' name='policy[policypremiumtransactions_attributes][0][feetransactions_attributes]["+a+"][fee_id]' autocomplete='off' value="+t[0].id+"></input> <!--input type='hidden' id='feevalue_"+t[0].id+"' class='BLselect span2' type='text' size='30' name='policy[policypremiumtransactions_attributes][0][feetransactions_attributes]["+a+"][fee_value]' autocomplete='off' value="+t[0].fee_value+"></input><input type='hidden' id='feetype_"+t[0].id+"' class='BLselect span2' type='text' size='30' name='policy[policypremiumtransactions_attributes][0][feetransactions_attributes]["+a+"][fee_type]' autocomplete='off' value="+t[0].fee_type+"></input--></td></tr>"),i+=roundfix(o*t[0].fee_value)):($("#feerow").after("<tr class='complexrow'><td>&nbsp;&nbsp; + "+t[0].fee_name+"</td><td> <div class='complexfee'><input id='fees_"+t[0].id+"' class='BLselect span2' type='text' size='30' name='policy[policypremiumtransactions_attributes][0][feetransactions_attributes]["+a+"][fee_amount]' autocomplete='off' value="+t[0].fee_value+"></div><input type='hidden' id='feesid_"+t[0].id+"' class='BLselect span2' type='text' size='30' name='policy[policypremiumtransactions_attributes][0][feetransactions_attributes]["+a+"][fee_id]' autocomplete='off' value="+t[0].id+"></input> <!--input type='hidden' id='feevalue_"+t[0].id+"' class='BLselect span2' type='text' size='30' name='policy[policypremiumtransactions_attributes][0][feetransactions_attributes]["+a+"][fee_value]' autocomplete='off' value="+t[0].fee_value+"></input><input type='hidden' id='feetype_"+t[0].id+"' class='BLselect span2' type='text' size='30' name='policy[policypremiumtransactions_attributes][0][feetransactions_attributes]["+a+"][fee_type]' autocomplete='off' value="+t[0].fee_type+"></input--></td></tr>"),i+=1*t[0].fee_value),a+=1}),$(".complexfee input").formatCurrency(),$(".complexfee input").live("change",function(){$(".complexfee input").formatCurrency(),feegnome()}),0<a&&($("#complexfeerow").slideDown(300),$("#complexfeetotal").val(i).formatCurrency(),$("#simplefeerow").hide()),totalpremcalc()}})}function recalculatefees(){var i=0;$(".complexfee input").each(function(){var e=$(this).val().replace(/[^0-9\.]+/g,""),t=parseFloat(e).toFixed(2);i=Number(i)+Number(t)}),$("#complexfeetotal").val(i).formatCurrency(),totalpremcalc()}function invoicedategnome(){var e=$("#policy_effective_date").val();$.ajax({type:"GET",dataType:"text",data:"effectivedate="+e,url:"/policies/invoicedue",success:function(e){$("#policy_policypremiumtransactions_attributes_0_invoices_attributes_0_due_on").val(e),$("#policy_policypremiumtransactions_attributes_0_invoices_attributes_0_due_on").effect("highlight",1e3)}})}function checkeffdate(){var e=$("#policy_effective_date").val(),t=new Date(e);t.setHours(24),t<new Date&&($("#dialogquestion").dialog(),$("#dialogquestion").html('<b>Are you sure you want an effective date in the past?</b> </br> <button id="yestoenter">Yes </button> <button id="notoenter">No </button> '),$("#yestoenter").click(function(){$("#dialogquestion").dialog("close")}),$("#notoenter").click(function(){$("#policy_effective_date").val(null),$("#policy_expiration_date").val(null),$("#dialogquestion").dialog("close")}))}function expdategnome(){var e=$("#policy_policy_term").val();"12 Month"==e&&expdateforce(12),"6 Month"==e&&expdateforce(6)}function expdateforce(e){var t=$("#policy_effective_date").val(),i=new Date(t);i.setDate(i.getDate()),i.setMonth(i.getMonth()+e);var a=i.getDate(),o=i.getMonth()+1,c=i.getFullYear();a<10&&(a="0"+a),o<10&&(o="0"+o),""!=t&&($("#policy_expiration_date").val(o+"/"+a+"/"+c),$("#policy_expiration_date").effect("highlight",1e3))}function totalpremcalc(){if(null!=$("#complexfeetotal").val())var e=$("#complexfeetotal").val().replace(/[^0-9\.]+/g,""),t=parseFloat(e).toFixed(2);if(null!=$("#policy_policypremiumtransactions_attributes_0_fees").val())var i=$("#policy_policypremiumtransactions_attributes_0_fees").val().replace(/[^0-9\.]+/g,"");var a=parseFloat(i).toFixed(2);if(null!=$("#policy_policypremiumtransactions_attributes_0_base_premium").val())var o=$("#policy_policypremiumtransactions_attributes_0_base_premium").val().replace(/[^0-9\.]+/g,"");var c=parseFloat(o).toFixed(2);isNaN(a)&&(a=0),isNaN(c)&&(c=0),isNaN(t)&&(t=0),$("#policy_policypremiumtransactions_attributes_0_total_premium").val(Number(c)+Number(a)+Number(t)),$("#policy_policypremiumtransactions_attributes_0_total_premium").formatCurrency(),$("#policy_policypremiumtransactions_attributes_0_base_premium").formatCurrency()}$(document).ready(function(){$("#policy_effective_date").datepicker(),$("#policy_expiration_date").datepicker(),$("#policy_policypremiumtransactions_attributes_0_invoices_attributes_0_due_on").datepicker(),$("#complexfeerow").hide(),$("#policy_carrier_id").change(carrierlobgnome),$("#policy_lineofbusiness_id").change(onLobChange),$("#policy_line_id").change(function(){}),$("#policy_policypremiumtransactions_attributes_0_fees").change(function(){$(this).formatCurrency()}),$("#policy_policypremiumtransactions_attributes_0_invoices_attributes_0_total_billed").change(function(){$(this).formatCurrency()}),$("#new_policy").validate(),$("#calcpolicy").on("click.mynamespace",function(){feegnome()}),$("#policy_policypremiumtransactions_attributes_0_base_premium").change(function(){feegnome(),$("#policy_policypremiumtransactions_attributes_0_base_premium").formatCurrency()}),$("#policy_policypremiumtransactions_attributes_0_fees").change(function(){feegnome(),totalpremcalc()}),$("#complexfeetotal").change(function(){feegnome(),$("#complexfeetotal").formatCurrency(),totalpremcalc()}),$("#policy_effective_date").change(function(){expdategnome(),checkeffdate(),invoicedategnome(),feecalculation()}),$("#policy_expiration_date").change(function(){expdategnome()}),$("#policy_policy_term").change(function(){expdategnome()}),totalpremcalc(),onLobChange()});