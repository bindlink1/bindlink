/*! AutoFill 2.1.0
 * Â©2008-2015 SpryMedia Ltd - datatables.net/license
 */
/**
 * @summary     AutoFill
 * @description Add Excel like click and drag auto-fill options to DataTables
 * @version     2.1.0
 * @file        dataTables.autoFill.js
 * @author      SpryMedia Ltd (www.sprymedia.co.uk)
 * @contact     www.sprymedia.co.uk/contact
 * @copyright   Copyright 2010-2015 SpryMedia Ltd.
 *
 * This source file is free software, available under the following license:
 *   MIT license - http://datatables.net/license/mit
 *
 * This source file is distributed in the hope that it will be useful, but
 * WITHOUT ANY WARRANTY; without even the implied warranty of MERCHANTABILITY
 * or FITNESS FOR A PARTICULAR PURPOSE. See the license files for details.
 *
 * For details please refer to: http://www.datatables.net
 */
!function(o){"function"==typeof define&&define.amd?define(["jquery","datatables.net"],function(t){return o(t,window,document)}):"object"==typeof exports?module.exports=function(t,e){return t||(t=window),e&&e.fn.dataTable||(e=require("datatables.net")(t,e).$),o(e,t,t.document)}:o(jQuery,window,document)}(function(p,s,h,b){"use strict";var n=p.fn.dataTable,o=0,r=function(t,e){if(!n.versionCheck||!n.versionCheck("1.10.8"))throw"Warning: AutoFill requires DataTables 1.10.8 or greater";this.c=p.extend(!0,{},n.defaults.autoFill,r.defaults,e),this.s={dt:new n.Api(t),namespace:".autoFill"+o++,scroll:{},scrollInterval:null,handle:{height:0,width:0}},this.dom={handle:p('<div class="dt-autofill-handle"/>'),select:{top:p('<div class="dt-autofill-select top"/>'),right:p('<div class="dt-autofill-select right"/>'),bottom:p('<div class="dt-autofill-select bottom"/>'),left:p('<div class="dt-autofill-select left"/>')},background:p('<div class="dt-autofill-background"/>'),list:p('<div class="dt-autofill-list">'+this.s.dt.i18n("autoFill.info","")+"<ul/></div>"),dtScroll:null,offsetParent:null},this._constructor()};return p.extend(r.prototype,{_constructor:function(){var e=this,t=this.s.dt,o=p("div.dataTables_scrollBody",this.s.dt.table().container());o.length&&"static"===(this.dom.dtScroll=o).css("position")&&o.css("position","relative"),this._focusListener(),this.dom.handle.on("mousedown",function(t){return e._mousedown(t),!1}),t.on("destroy.autoFill",function(){t.off(".autoFill"),p(t.table().body()).off(e.s.namespace),p(h.body).off(e.s.namespace)})},_attach:function(t){var e=this.s.dt,o=e.cell(t).index(),i=this.dom.handle,l=this.s.handle;if(o&&-1!==e.columns(this.c.columns).indexes().indexOf(o.column)){this.dom.offsetParent||(this.dom.offsetParent=p(t).offsetParent()),l.height&&l.width||(i.appendTo("body"),l.height=i.outerHeight(),l.width=i.outerWidth());var n=p(t).position();this.dom.attachedTo=t,i.css({top:n.top+t.offsetHeight-l.height,left:n.left+t.offsetWidth-l.width}).appendTo(this.dom.offsetParent)}else this._detach()},_actionSelector:function(o){var i=this,l=this.s.dt,n=r.actions,s=[];if(p.each(n,function(t,e){e.available(l,o)&&s.push(t)}),1===s.length&&!1===this.c.alwaysAsk){var t=n[s[0]].execute(l,o);this._update(t,o)}else{var a=this.dom.list.children("ul").empty();s.push("cancel"),p.each(s,function(t,e){a.append(p("<li/>").append('<div class="dt-autofill-question">'+n[e].option(l,o)+"<div>").append(p('<div class="dt-autofill-button">').append(p('<button class="'+r.classes.btn+'">'+l.i18n("autoFill.button","&gt;")+"</button>").on("click",function(){var t=n[e].execute(l,o,p(this).closest("li"));i._update(t,o),i.dom.background.remove(),i.dom.list.remove()}))))}),this.dom.background.appendTo("body"),this.dom.list.appendTo("body"),this.dom.list.css("margin-top",this.dom.list.outerHeight()/2*-1)}},_detach:function(){this.dom.attachedTo=null,this.dom.handle.detach()},_drawSelection:function(t){var e=this.s.dt,o=this.s.start,i=p(this.dom.start),l=p(t),n={row:e.rows({page:"current"}).nodes().indexOf(l.parent()[0]),column:l.index()};if(e.cell(l).any()&&-1!==e.columns(this.c.columns).indexes().indexOf(n.column)){var s,a,r,d,c,u;this.s.end=n,s=o.row<n.row?i:l,a=o.row<n.row?l:i,r=o.column<n.column?i:l,d=o.column<n.column?l:i,s=s.position().top,r=r.position().left,c=a.position().top+a.outerHeight()-s,u=d.position().left+d.outerWidth()-r;var h=this.dom.dtScroll;h&&(s+=h.scrollTop(),r+=h.scrollLeft());var f=this.dom.select;f.top.css({top:s,left:r,width:u}),f.left.css({top:s,left:r,height:c}),f.bottom.css({top:s+c,left:r,width:u}),f.right.css({top:s,left:r+u,height:c})}},_editor:function(t){var e=this.s.dt,o=this.c.editor;if(o){for(var i={},l=[],n=o.fields(),s=0,a=t.length;s<a;s++)for(var r=0,d=t[s].length;r<d;r++){var c=t[s][r],u=e.settings()[0].aoColumns[c.index.column],h=u.editField;if(h===b)for(var f=u.mData,p=0,m=n.length;p<m;p++){var v=o.field(n[p]);if(v.dataSrc()===f){h=v.name();break}}if(!h)throw"Could not automatically determine field data. Please see https://datatables.net/tn/11";i[h]||(i[h]={});var g=e.row(c.index.row).id();i[h][g]=c.set,l.push(c.index)}o.bubble(l,!1).multiSet(i).submit()}},_emitEvent:function(e,o){this.s.dt.iterator("table",function(t){p(t.nTable).triggerHandler(e+".dt",o)})},_focusListener:function(){var i=this,e=this.s.dt,t=this.s.namespace,o=null!==this.c.focus?this.c.focus:e.settings()[0].keytable?"focus":"hover";"focus"===o?e.on("key-focus.autoFill",function(t,e,o){i._attach(o.node())}).on("key-blur.autoFill",function(){i._detach()}):"click"===o?(p(e.table().body()).on("click"+t,"td, th",function(){i._attach(this)}),p(h.body).on("click"+t,function(t){p(t.target).parents().filter(e.table().body()).length||i._detach()})):p(e.table().body()).on("mouseenter"+t,"td, th",function(){i._attach(this)}).on("mouseleave"+t,function(t){p(t.relatedTarget).hasClass("dt-autofill-handle")||i._detach()})},_mousedown:function(t){var e=this,o=this.s.dt;this.dom.start=this.dom.attachedTo,this.s.start={row:o.rows({page:"current"}).nodes().indexOf(p(this.dom.start).parent()[0]),column:p(this.dom.start).index()},p(h.body).on("mousemove.autoFill",function(t){e._mousemove(t)}).on("mouseup.autoFill",function(t){e._mouseup(t)});var i=this.dom.select,l=p(this.s.dt.table().body()).offsetParent();i.top.appendTo(l),i.left.appendTo(l),i.right.appendTo(l),i.bottom.appendTo(l),this._drawSelection(this.dom.start,t),this.dom.handle.css("display","none");var n=this.dom.dtScroll;this.s.scroll={windowHeight:p(s).height(),windowWidth:p(s).width(),dtTop:n?n.offset().top:null,dtLeft:n?n.offset().left:null,dtHeight:n?n.outerHeight():null,dtWidth:n?n.outerWidth():null}},_mousemove:function(t){this.s.dt;var e=t.target.nodeName.toLowerCase();"td"!==e&&"th"!==e||(this._drawSelection(t.target,t),this._shiftScroll(t))},_mouseup:function(){p(h.body).off(".autoFill");var o=this.s.dt,t=this.dom.select;t.top.remove(),t.left.remove(),t.right.remove(),t.bottom.remove(),this.dom.handle.css("display","block");var e=this.s.start,i=this.s.end;if(e.row!==i.row||e.column!==i.column){for(var l=this._range(e.row,i.row),n=this._range(e.column,i.column),s=[],a=0;a<l.length;a++)s.push(p.map(n,function(t){var e=o.cell(":eq("+l[a]+")",t+":visible",{page:"current"});return{cell:e,data:e.data(),index:e.index()}}));this._actionSelector(s)}},_range:function(t,e){var o,i=[];if(t<=e)for(o=t;o<=e;o++)i.push(o);else for(o=t;e<=o;o--)i.push(o);return i},_shiftScroll:function(t){var e,o,i,l,n=this,s=(this.s.dt,this.s.scroll),a=!1,r=5,d=65,c=t.pageY-h.body.scrollTop,u=t.pageX-h.body.scrollLeft;c<d?e=-1*r:c>s.windowHeight-d&&(e=r),u<d?o=-1*r:u>s.windowWidth-d&&(o=r),null!==s.dtTop&&t.pageY<s.dtTop+d?i=-1*r:null!==s.dtTop&&t.pageY>s.dtTop+s.dtHeight-d&&(i=r),null!==s.dtLeft&&t.pageX<s.dtLeft+d?l=-1*r:null!==s.dtLeft&&t.pageX>s.dtLeft+s.dtWidth-d&&(l=r),e||o||i||l?(s.windowVert=e,s.windowHoriz=o,s.dtVert=i,s.dtHoriz=l,a=!0):this.s.scrollInterval&&(clearInterval(this.s.scrollInterval),this.s.scrollInterval=null),!this.s.scrollInterval&&a&&(this.s.scrollInterval=setInterval(function(){if(s.windowVert&&(h.body.scrollTop+=s.windowVert),s.windowHoriz&&(h.body.scrollLeft+=s.windowHoriz),s.dtVert||s.dtHoriz){var t=n.dom.dtScroll[0];s.dtVert&&(t.scrollTop+=s.dtVert),s.dtHoriz&&(t.scrollLeft+=s.dtHoriz)}},20))},_update:function(t,e){if(!1!==t){var o,i=this.s.dt;if(this._emitEvent("preAutoFill",[i,e]),this._editor(e),null!==this.c.update?this.c.update:!this.c.editor){for(var l=0,n=e.length;l<n;l++)for(var s=0,a=e[l].length;s<a;s++)(o=e[l][s]).cell.data(o.set);i.draw(!1)}this._emitEvent("autoFill",[i,e])}}}),r.actions={increment:{available:function(t,e){return p.isNumeric(e[0][0].data)},option:function(t){return t.i18n("autoFill.increment",'Increment / decrement each cell by: <input type="number" value="1">')},execute:function(t,e,o){for(var i=1*e[0][0].data,l=1*p("input",o).val(),n=0,s=e.length;n<s;n++)for(var a=0,r=e[n].length;a<r;a++)e[n][a].set=i,i+=l}},fill:{available:function(){return!0},option:function(t,e){return t.i18n("autoFill.fill","Fill all cells with <i>"+e[0][0].data+"</i>")},execute:function(t,e){for(var o=e[0][0].data,i=0,l=e.length;i<l;i++)for(var n=0,s=e[i].length;n<s;n++)e[i][n].set=o}},fillHorizontal:{available:function(t,e){return 1<e.length&&1<e[0].length},option:function(t){return t.i18n("autoFill.fillHorizontal","Fill cells horizontally")},execute:function(t,e){for(var o=0,i=e.length;o<i;o++)for(var l=0,n=e[o].length;l<n;l++)e[o][l].set=e[o][0].data}},fillVertical:{available:function(t,e){return 1<e.length&&1<e[0].length},option:function(t){return t.i18n("autoFill.fillVertical","Fill cells vertically")},execute:function(t,e){for(var o=0,i=e.length;o<i;o++)for(var l=0,n=e[o].length;l<n;l++)e[o][l].set=e[0][l].data}},cancel:{available:function(){return!1},option:function(t){return t.i18n("autoFill.cancel","Cancel")},execute:function(){return!1}}},r.version="2.1.0",r.defaults={alwaysAsk:!1,focus:null,columns:"",update:null,editor:null},r.classes={btn:"btn"},p(h).on("preInit.dt.autofill",function(t,e){if("dt"===t.namespace){var o=e.oInit.autoFill,i=n.defaults.autoFill;if(o||i){var l=p.extend({},o,i);!1!==o&&new r(e,l)}}}),n.AutoFill=r,n.AutoFill=r});