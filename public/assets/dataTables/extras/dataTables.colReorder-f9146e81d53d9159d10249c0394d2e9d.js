/*! ColReorder 1.3.0
 * Â©2010-2015 SpryMedia Ltd - datatables.net/license
 */
/**
 * @summary     ColReorder
 * @description Provide the ability to reorder columns in a DataTable
 * @version     1.3.0
 * @file        dataTables.colReorder.js
 * @author      SpryMedia Ltd (www.sprymedia.co.uk)
 * @contact     www.sprymedia.co.uk/contact
 * @copyright   Copyright 2010-2014 SpryMedia Ltd.
 *
 * This source file is free software, available under the following license:
 *   MIT license - http://datatables.net/license/mit
 *
 * This source file is distributed in the hope that it will be useful, but
 * WITHOUT ANY WARRANTY; without even the implied warranty of MERCHANTABILITY
 * or FITNESS FOR A PARTICULAR PURPOSE. See the license files for details.
 *
 * For details please refer to: http://www.datatables.net
 */
!function(o){"function"==typeof define&&define.amd?define(["jquery","datatables.net"],function(t){return o(t,window,document)}):"object"==typeof exports?module.exports=function(t,e){return t||(t=window),e&&e.fn.dataTable||(e=require("datatables.net")(t,e).$),o(e,t,t.document)}:o(jQuery,window,document)}(function(p,t,r,a){"use strict";function R(t){for(var e=[],o=0,s=t.length;o<s;o++)e[t[o]]=o;return e}function x(t,e,o){var s=t.splice(e,1)[0];t.splice(o,0,s)}function _(t,e,o){for(var s=[],n=0,r=t.childNodes.length;n<r;n++)1==t.childNodes[n].nodeType&&s.push(t.childNodes[n]);var i=s[e];null!==o?t.insertBefore(i,s[o]):t.appendChild(i)}var i=p.fn.dataTable;p.fn.dataTableExt.oApi.fnColReorder=function(o,t,e,s){var n,r,i,a,l,d,f=o.aoColumns.length,h=function(t,e,o){if(t[e]&&"function"!=typeof t[e]){var s=t[e].split("."),n=s.shift();isNaN(1*n)||(t[e]=o[1*n]+"."+s.join("."))}};if(t!=e)if(t<0||f<=t)this.oApi._fnLog(o,1,"ColReorder 'from' index is out of bounds: "+t);else if(e<0||f<=e)this.oApi._fnLog(o,1,"ColReorder 'to' index is out of bounds: "+e);else{var u=[];for(n=0,r=f;n<r;n++)u[n]=n;x(u,t,e);var c=R(u);for(n=0,r=o.aaSorting.length;n<r;n++)o.aaSorting[n][0]=c[o.aaSorting[n][0]];if(null!==o.aaSortingFixed)for(n=0,r=o.aaSortingFixed.length;n<r;n++)o.aaSortingFixed[n][0]=c[o.aaSortingFixed[n][0]];for(n=0,r=f;n<r;n++){for(i=0,a=(d=o.aoColumns[n]).aDataSort.length;i<a;i++)d.aDataSort[i]=c[d.aDataSort[i]];d.idx=c[d.idx]}for(p.each(o.aLastSort,function(t,e){o.aLastSort[t].src=c[e.src]}),n=0,r=f;n<r;n++)"number"==typeof(d=o.aoColumns[n]).mData?(d.mData=c[d.mData],o.oApi._fnColumnOptions(o,n,{})):p.isPlainObject(d.mData)&&(h(d.mData,"_",c),h(d.mData,"filter",c),h(d.mData,"sort",c),h(d.mData,"type",c),o.oApi._fnColumnOptions(o,n,{}));if(o.aoColumns[t].bVisible){var m=this.oApi._fnColumnIndexToVisible(o,t),g=null;for(n=e<t?e:e+1;null===g&&n<f;)g=this.oApi._fnColumnIndexToVisible(o,n),n++;for(n=0,r=(l=o.nTHead.getElementsByTagName("tr")).length;n<r;n++)_(l[n],m,g);if(null!==o.nTFoot)for(n=0,r=(l=o.nTFoot.getElementsByTagName("tr")).length;n<r;n++)_(l[n],m,g);for(n=0,r=o.aoData.length;n<r;n++)null!==o.aoData[n].nTr&&_(o.aoData[n].nTr,m,g)}for(x(o.aoColumns,t,e),x(o.aoPreSearchCols,t,e),n=0,r=o.aoData.length;n<r;n++){var C=o.aoData[n];C.anCells&&x(C.anCells,t,e),"dom"!==C.src&&p.isArray(C._aData)&&x(C._aData,t,e)}for(n=0,r=o.aoHeader.length;n<r;n++)x(o.aoHeader[n],t,e);if(null!==o.aoFooter)for(n=0,r=o.aoFooter.length;n<r;n++)x(o.aoFooter[n],t,e);for(new p.fn.dataTable.Api(o).rows().invalidate(),n=0,r=f;n<r;n++)p(o.aoColumns[n].nTh).off("click.DT"),this.oApi._fnSortAttachListener(o,o.aoColumns[n].nTh,n);p(o.oInstance).trigger("column-reorder.dt",[o,{from:t,to:e,mapping:c,drop:s,iFrom:t,iTo:e,aiInvertMapping:c}])}};var l=function(t,e){var o=new p.fn.dataTable.Api(t).settings()[0];if(o._colReorder)return o._colReorder;!0===e&&(e={});var s=p.fn.dataTable.camelToHungarian;return s&&(s(l.defaults,l.defaults,!0),s(l.defaults,e||{})),this.s={dt:null,init:p.extend(!0,{},l.defaults,e),fixed:0,fixedRight:0,reorderCallback:null,mouse:{startX:-1,startY:-1,offsetX:-1,offsetY:-1,target:-1,targetIndex:-1,fromIndex:-1},aoTargets:[]},this.dom={drag:null,pointer:null},this.s.dt=o,(this.s.dt._colReorder=this)._fnConstruct(),this};return p.extend(l.prototype,{fnReset:function(){return this._fnOrderColumns(this.fnOrder()),this},fnGetCurrentOrder:function(){return this.fnOrder()},fnOrder:function(t,e){var o,s,n=[],r=this.s.dt.aoColumns;if(t===a){for(o=0,s=r.length;o<s;o++)n.push(r[o]._ColReorder_iOrigCol);return n}if(e){var i=this.fnOrder();for(o=0,s=t.length;o<s;o++)n.push(p.inArray(t[o],i));t=n}return this._fnOrderColumns(R(t)),this},fnTranspose:function(t,e){e||(e="toCurrent");var o=this.fnOrder(),s=this.s.dt.aoColumns;return"toCurrent"===e?p.isArray(t)?p.map(t,function(t){return p.inArray(t,o)}):p.inArray(t,o):p.isArray(t)?p.map(t,function(t){return s[t]._ColReorder_iOrigCol}):s[t]._ColReorder_iOrigCol},_fnConstruct:function(){var t,o=this,e=this.s.dt.aoColumns.length,s=this.s.dt.nTable;for(this.s.init.iFixedColumns&&(this.s.fixed=this.s.init.iFixedColumns),this.s.init.iFixedColumnsLeft&&(this.s.fixed=this.s.init.iFixedColumnsLeft),this.s.fixedRight=this.s.init.iFixedColumnsRight?this.s.init.iFixedColumnsRight:0,this.s.init.fnReorderCallback&&(this.s.reorderCallback=this.s.init.fnReorderCallback),t=0;t<e;t++)t>this.s.fixed-1&&t<e-this.s.fixedRight&&this._fnMouseListener(t,this.s.dt.aoColumns[t].nTh),this.s.dt.aoColumns[t]._ColReorder_iOrigCol=t;this.s.dt.oApi._fnCallbackReg(this.s.dt,"aoStateSaveParams",function(t,e){o._fnStateSave.call(o,e)},"ColReorder_State");var n=null;if(this.s.init.aiOrder&&(n=this.s.init.aiOrder.slice()),this.s.dt.oLoadedState&&"undefined"!=typeof this.s.dt.oLoadedState.ColReorder&&this.s.dt.oLoadedState.ColReorder.length==this.s.dt.aoColumns.length&&(n=this.s.dt.oLoadedState.ColReorder),n)if(o.s.dt._bInitComplete){var r=R(n);o._fnOrderColumns.call(o,r)}else{var i=!1;p(s).on("draw.dt.colReorder",function(){if(!o.s.dt._bInitComplete&&!i){i=!0;var t=R(n);o._fnOrderColumns.call(o,t)}})}else this._fnSetColumnIndexes();p(s).on("destroy.dt.colReorder",function(){p(s).off("destroy.dt.colReorder draw.dt.colReorder"),p(o.s.dt.nTHead).find("*").off(".ColReorder"),p.each(o.s.dt.aoColumns,function(t,e){p(e.nTh).removeAttr("data-column-index")}),o.s.dt._colReorder=null,o.s=null})},_fnOrderColumns:function(t){var e=!1;if(t.length==this.s.dt.aoColumns.length){for(var o=0,s=t.length;o<s;o++){var n=p.inArray(o,t);o!=n&&(x(t,n,o),this.s.dt.oInstance.fnColReorder(n,o,!0),e=!0)}this._fnSetColumnIndexes(),e&&(""===this.s.dt.oScroll.sX&&""===this.s.dt.oScroll.sY||this.s.dt.oInstance.fnAdjustColumnSizing(!1),this.s.dt.oInstance.oApi._fnSaveState(this.s.dt),null!==this.s.reorderCallback&&this.s.reorderCallback.call(this))}else this.s.dt.oInstance.oApi._fnLog(this.s.dt,1,"ColReorder - array reorder does not match known number of columns. Skipping.")},_fnStateSave:function(t){var e,o,s,n=this.s.dt.aoColumns;if(t.ColReorder=[],t.aaSorting){for(e=0;e<t.aaSorting.length;e++)t.aaSorting[e][0]=n[t.aaSorting[e][0]]._ColReorder_iOrigCol;var r=p.extend(!0,[],t.aoSearchCols);for(e=0,o=n.length;e<o;e++)s=n[e]._ColReorder_iOrigCol,t.aoSearchCols[s]=r[e],t.abVisCols[s]=n[e].bVisible,t.ColReorder.push(s)}else if(t.order){for(e=0;e<t.order.length;e++)t.order[e][0]=n[t.order[e][0]]._ColReorder_iOrigCol;var i=p.extend(!0,[],t.columns);for(e=0,o=n.length;e<o;e++)s=n[e]._ColReorder_iOrigCol,t.columns[s]=i[e],t.ColReorder.push(s)}},_fnMouseListener:function(t,e){var o=this;p(e).on("mousedown.ColReorder",function(t){t.preventDefault(),o._fnMouseDown.call(o,t,e)})},_fnMouseDown:function(t,e){var o=this,s=p(t.target).closest("th, td").offset(),n=parseInt(p(e).attr("data-column-index"),10);n!==a&&(this.s.mouse.startX=t.pageX,this.s.mouse.startY=t.pageY,this.s.mouse.offsetX=t.pageX-s.left,this.s.mouse.offsetY=t.pageY-s.top,this.s.mouse.target=this.s.dt.aoColumns[n].nTh,this.s.mouse.targetIndex=n,this.s.mouse.fromIndex=n,this._fnRegions(),p(r).on("mousemove.ColReorder",function(t){o._fnMouseMove.call(o,t)}).on("mouseup.ColReorder",function(t){o._fnMouseUp.call(o,t)}))},_fnMouseMove:function(t){if(null===this.dom.drag){if(Math.pow(Math.pow(t.pageX-this.s.mouse.startX,2)+Math.pow(t.pageY-this.s.mouse.startY,2),.5)<5)return;this._fnCreateDragNode()}this.dom.drag.css({left:t.pageX-this.s.mouse.offsetX,top:t.pageY-this.s.mouse.offsetY});for(var e=!1,o=this.s.mouse.toIndex,s=1,n=this.s.aoTargets.length;s<n;s++)if(t.pageX<this.s.aoTargets[s-1].x+(this.s.aoTargets[s].x-this.s.aoTargets[s-1].x)/2){this.dom.pointer.css("left",this.s.aoTargets[s-1].x),this.s.mouse.toIndex=this.s.aoTargets[s-1].to,e=!0;break}e||(this.dom.pointer.css("left",this.s.aoTargets[this.s.aoTargets.length-1].x),this.s.mouse.toIndex=this.s.aoTargets[this.s.aoTargets.length-1].to),this.s.init.bRealtime&&o!==this.s.mouse.toIndex&&(this.s.dt.oInstance.fnColReorder(this.s.mouse.fromIndex,this.s.mouse.toIndex,!1),this.s.mouse.fromIndex=this.s.mouse.toIndex,this._fnRegions())},_fnMouseUp:function(){p(r).off("mousemove.ColReorder mouseup.ColReorder"),null!==this.dom.drag&&(this.dom.drag.remove(),this.dom.pointer.remove(),this.dom.drag=null,this.dom.pointer=null,this.s.dt.oInstance.fnColReorder(this.s.mouse.fromIndex,this.s.mouse.toIndex,!0),this._fnSetColumnIndexes(),""===this.s.dt.oScroll.sX&&""===this.s.dt.oScroll.sY||this.s.dt.oInstance.fnAdjustColumnSizing(!1),this.s.dt.oInstance.oApi._fnSaveState(this.s.dt),null!==this.s.reorderCallback&&this.s.reorderCallback.call(this))},_fnRegions:function(){var t=this.s.dt.aoColumns;this.s.aoTargets.splice(0,this.s.aoTargets.length),this.s.aoTargets.push({x:p(this.s.dt.nTable).offset().left,to:0});for(var e=0,o=p(t[0].nTh).offset().left,s=0,n=t.length;s<n;s++)s!=this.s.mouse.fromIndex&&e++,t[s].bVisible&&(o+=p(t[s].nTh).outerWidth(),this.s.aoTargets.push({x:o,to:e}));0!==this.s.fixedRight&&this.s.aoTargets.splice(this.s.aoTargets.length-this.s.fixedRight),0!==this.s.fixed&&this.s.aoTargets.splice(0,this.s.fixed)},_fnCreateDragNode:function(){var t=""!==this.s.dt.oScroll.sX||""!==this.s.dt.oScroll.sY,e=this.s.dt.aoColumns[this.s.mouse.targetIndex].nTh,o=e.parentNode,s=o.parentNode,n=s.parentNode,r=p(e).clone();this.dom.drag=p(n.cloneNode(!1)).addClass("DTCR_clonedTable").append(p(s.cloneNode(!1)).append(p(o.cloneNode(!1)).append(r[0]))).css({position:"absolute",top:0,left:0,width:p(e).outerWidth(),height:p(e).outerHeight()}).appendTo("body"),this.dom.pointer=p("<div></div>").addClass("DTCR_pointer").css({position:"absolute",top:t?p("div.dataTables_scroll",this.s.dt.nTableWrapper).offset().top:p(this.s.dt.nTable).offset().top,height:t?p("div.dataTables_scroll",this.s.dt.nTableWrapper).height():p(this.s.dt.nTable).height()}).appendTo("body")},_fnSetColumnIndexes:function(){p.each(this.s.dt.aoColumns,function(t,e){p(e.nTh).attr("data-column-index",t)})}}),l.defaults={aiOrder:null,bRealtime:!0,iFixedColumnsLeft:0,iFixedColumnsRight:0,fnReorderCallback:null},l.version="1.3.0",p.fn.dataTable.ColReorder=l,p.fn.DataTable.ColReorder=l,"function"==typeof p.fn.dataTable&&"function"==typeof p.fn.dataTableExt.fnVersionCheck&&p.fn.dataTableExt.fnVersionCheck("1.10.8")?p.fn.dataTableExt.aoFeatures.push({fnInit:function(t){var e=t.oInstance;if(t._colReorder)e.oApi._fnLog(t,1,"ColReorder attempted to initialise twice. Ignoring second");else{var o=t.oInit,s=o.colReorder||o.oColReorder||{};new l(t,s)}return null},cFeature:"R",sFeature:"ColReorder"}):alert("Warning: ColReorder requires DataTables 1.10.8 or greater - www.datatables.net/download"),p(r).on("preInit.dt.colReorder",function(t,e){if("dt"===t.namespace){var o=e.oInit.colReorder,s=i.defaults.colReorder;if(o||s){var n=p.extend({},o,s);!1!==o&&new l(e,n)}}}),p.fn.dataTable.Api.register("colReorder.reset()",function(){return this.iterator("table",function(t){t._colReorder.fnReset()})}),p.fn.dataTable.Api.register("colReorder.order()",function(e,o){return e?this.iterator("table",function(t){t._colReorder.fnOrder(e,o)}):this.context.length?this.context[0]._colReorder.fnOrder():null}),p.fn.dataTable.Api.register("colReorder.transpose()",function(t,e){return this.context.length&&this.context[0]._colReorder?this.context[0]._colReorder.fnTranspose(t,e):t}),l});