!function(d){d.fn.maskMoney=function(m){return m=d.extend({symbol:"US$",showSymbol:!1,symbolStay:!1,thousands:",",decimal:".",precision:2,defaultZero:!0,allowZero:!1,allowNegative:!1},m),this.each(function(){function i(){g=!0}function s(){g=!1}function t(e){var t=(e=e||window.event).charCode||e.keyCode||e.which;if(t==undefined)return!1;if(h.attr("readonly")&&13!=t&&9!=t)return!1;if(t<48||57<t)return 45==t?(i(),h.val(f(h)),!1):43==t?(i(),h.val(h.val().replace("-","")),!1):(13==t||9==t?g&&(s(),d(this).change()):37==t||39==t||u(e),!0);if(h.val().length>=h.attr("maxlength"))return!1;u(e);var n=String.fromCharCode(t),a=h.get(0),r=h.getInputSelection(a),l=r.start,o=r.end;return a.value=a.value.substring(0,l)+n+a.value.substring(o,a.value.length),c(a,l+1),i(),!1}function e(e){var t=(e=e||window.event).charCode||e.keyCode||e.which;if(t==undefined)return!1;if(h.attr("readonly")&&13!=t&&9!=t)return!1;var n=h.get(0),a=h.getInputSelection(n),r=a.start,l=a.end;return 8==t?(u(e),r==l?(n.value=n.value.substring(0,r-1)+n.value.substring(l,n.value.length),r-=1):n.value=n.value.substring(0,r)+n.value.substring(l,n.value.length),c(n,r),i(),!1):9==t?(g&&(d(this).change(),s()),!0):46!=t&&63272!=t||(u(e),n.selectionStart==n.selectionEnd?n.value=n.value.substring(0,r)+n.value.substring(l+1,n.value.length):n.value=n.value.substring(0,r)+n.value.substring(l,n.value.length),c(n,r),i(),!1)}function n(){var e=o();if(h.val()==e?h.val(""):""==h.val()&&m.defaultZero?h.val(v(e)):h.val(v(h.val())),this.createTextRange){var t=this.createTextRange();t.collapse(!1),t.select()}}function a(e){d.browser.msie&&t(e),""==h.val()||h.val()==v(o())||h.val()==m.symbol?m.allowZero?m.symbolStay?h.val(v(o())):h.val(o()):h.val(""):m.symbolStay?m.symbolStay&&h.val()==m.symbol&&h.val(v(o())):h.val(h.val().replace(m.symbol,""))}function u(e){e.preventDefault?e.preventDefault():e.returnValue=!1}function c(e,t){var n=h.val().length;h.val(r(e.value)),t-=n-h.val().length,h.setCursorPosition(t)}function r(e){var t="0123456789",n=(e=e.replace(m.symbol,"")).length,a="",r="",l="";if(0!=n&&"-"==e.charAt(0)&&(e=e.replace("-",""),m.allowNegative&&(l="-")),0==n){if(!m.defaultZero)return r;r="0.00"}for(var o=0;o<n&&("0"==e.charAt(o)||e.charAt(o)==m.decimal);o++);for(;o<n;o++)-1!=t.indexOf(e.charAt(o))&&(a+=e.charAt(o));var i=parseFloat(a);r=(i=isNaN(i)?0:i/Math.pow(10,m.precision)).toFixed(m.precision),o=0==m.precision?0:1;var s,u=(r=r.split("."))[o].substr(0,m.precision);for(s=(r=r[0]).length;1<=(s-=3);)r=r.substr(0,s)+m.thousands+r.substr(s);return 0<m.precision?v(l+r+m.decimal+u+Array(m.precision+1-u.length).join(0)):v(l+r)}function l(){var e=h.val();h.val(r(e))}function o(){return(parseFloat("0")/Math.pow(10,m.precision)).toFixed(m.precision).replace(new RegExp("\\.","g"),m.decimal)}function v(e){return m.showSymbol&&e.substr(0,m.symbol.length)!=m.symbol?m.symbol+e:e}function f(e){if(m.allowNegative){e.val();return""!=e.val()&&"-"==e.val().charAt(0)?e.val().replace("-",""):"-"+e.val()}return e.val()}var h=d(this),g=!1;h.bind("keypress.maskMoney",t),h.bind("keydown.maskMoney",e),h.bind("blur.maskMoney",a),h.bind("focus.maskMoney",n),h.bind("mask",l),h.one("unmaskMoney",function(){h.unbind(".maskMoney"),d.browser.msie?this.onpaste=null:d.browser.mozilla&&this.removeEventListener("input",a,!1)})})},d.fn.unmaskMoney=function(){return this.trigger("unmaskMoney")},d.fn.mask=function(){return this.trigger("mask")},d.fn.setCursorPosition=function(a){return this.each(function(e,t){if(t.setSelectionRange)t.focus(),t.setSelectionRange(a,a);else if(t.createTextRange){var n=t.createTextRange();n.collapse(!0),n.moveEnd("character",a),n.moveStart("character",a),n.select()}}),this},d.fn.getInputSelection=function(e){var t,n,a,r,l,o=0,i=0;return"number"==typeof e.selectionStart&&"number"==typeof e.selectionEnd?(o=e.selectionStart,i=e.selectionEnd):(n=document.selection.createRange())&&n.parentElement()==e&&(r=e.value.length,t=e.value.replace(/\r\n/g,"\n"),(a=e.createTextRange()).moveToBookmark(n.getBookmark()),(l=e.createTextRange()).collapse(!1),-1<a.compareEndPoints("StartToEnd",l)?o=i=r:(o=-a.moveStart("character",-r),o+=t.slice(0,o).split("\n").length-1,-1<a.compareEndPoints("EndToEnd",l)?i=r:(i=-a.moveEnd("character",-r),i+=t.slice(0,i).split("\n").length-1))),{start:o,end:i}}}(jQuery);