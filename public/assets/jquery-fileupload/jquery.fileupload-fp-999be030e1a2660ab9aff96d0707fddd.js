/*
 * jQuery File Upload File Processing Plugin 1.2.1
 * https://github.com/blueimp/jQuery-File-Upload
 *
 * Copyright 2012, Sebastian Tschan
 * https://blueimp.net
 *
 * Licensed under the MIT license:
 * http://www.opensource.org/licenses/MIT
 */
!function(e){"use strict";"function"==typeof define&&define.amd?define(["jquery","load-image","canvas-to-blob","./jquery.fileupload"],e):e(window.jQuery,window.loadImage)}(function(r,o){"use strict";r.widget("blueimp.fileupload",r.blueimp.fileupload,{options:{process:[],add:function(e,i){r(this).fileupload("process",i).done(function(){i.submit()})}},processActions:{load:function(i,e){var s=this,n=i.files[i.index],t=r.Deferred();return window.HTMLCanvasElement&&window.HTMLCanvasElement.prototype.toBlob&&("number"!==r.type(e.maxFileSize)||n.size<e.maxFileSize)&&(!e.fileTypes||e.fileTypes.test(n.type))?o(n,function(e){if(!e.src)return t.rejectWith(s,[i]);i.img=e,t.resolveWith(s,[i])}):t.rejectWith(s,[i]),t.promise()},resize:function(e,i){var s,n=e.img;return i=r.extend({canvas:!0},i),n&&((s=o.scale(n,i)).width===n.width&&s.height===n.height||(e.canvas=s)),e},save:function(i){if(!i.canvas)return i;var s=this,n=i.files[i.index],e=n.name,t=r.Deferred(),o=function(e){e.name||(n.type===e.type?e.name=n.name:n.name&&(e.name=n.name.replace(/\..+$/,"."+e.type.substr(6)))),i.files[i.index]=e,t.resolveWith(s,[i])};return i.canvas.mozGetAsFile?o(i.canvas.mozGetAsFile(/^image\/(jpeg|png)$/.test(n.type)&&e||(e&&e.replace(/\..+$/,"")||"blob")+".png",n.type)):i.canvas.toBlob(o,n.type),t.promise()}},_processFile:function(e,i,s){var n=this,t=r.Deferred().resolveWith(n,[{files:e,index:i}]).promise();return n._processing+=1,r.each(s.process,function(e,i){t=t.pipe(function(e){return n.processActions[i.action].call(this,e,i)})}),t.always(function(){n._processing-=1,0===n._processing&&n.element.removeClass("fileupload-processing")}),1===n._processing&&n.element.addClass("fileupload-processing"),t},process:function(s){var n=this,t=r.extend({},this.options,s);return t.process&&t.process.length&&this._isXHRUpload(t)&&r.each(s.files,function(i){n._processingQueue=n._processingQueue.pipe(function(){var e=r.Deferred();return n._processFile(s.files,i,t).always(function(){e.resolveWith(n)}),e.promise()})}),this._processingQueue},_create:function(){this._super(),this._processing=0,this._processingQueue=r.Deferred().resolveWith(this).promise()}})});